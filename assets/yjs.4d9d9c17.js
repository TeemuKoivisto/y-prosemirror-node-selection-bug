import{P as be,a as _n,S as bt,F as kt,T as cs,m as hs,e as as,k as ds,s as us}from"./app.1b76756a.js";const V=()=>new Map,Lt=s=>{const t=V();return s.forEach((e,n)=>{t.set(n,e)}),t},Y=(s,t,e)=>{let n=s.get(t);return n===void 0&&s.set(t,n=e()),n},fs=(s,t)=>{const e=[];for(const[n,i]of s)e.push(t(i,n));return e},gs=(s,t)=>{for(const[e,n]of s)if(t(n,e))return!0;return!1},tt=()=>new Set,Qt=s=>s[s.length-1],ps=(s,t)=>{for(let e=0;e<t.length;e++)s.push(t[e])},yn=Array.from,je=Array.isArray;class bn{constructor(){this._observers=V()}on(t,e){Y(this._observers,t,tt).add(e)}once(t,e){const n=(...i)=>{this.off(t,n),e(...i)};this.on(t,n)}off(t,e){const n=this._observers.get(t);n!==void 0&&(n.delete(e),n.size===0&&this._observers.delete(t))}emit(t,e){return yn((this._observers.get(t)||V()).values()).forEach(n=>n(...e))}destroy(){this._observers=V()}}const G=Math.floor,Tt=Math.abs,zt=(s,t)=>s<t?s:t,it=(s,t)=>s>t?s:t,ws=s=>s!==0?s<0:1/s<0,ms=s=>s.toLowerCase(),_s=/^\s*/g,ys=s=>s.replace(_s,""),bs=/([A-Z])/g,ze=(s,t)=>ys(s.replace(bs,e=>`${t}${ms(e)}`)),ks=s=>{const t=unescape(encodeURIComponent(s)),e=t.length,n=new Uint8Array(e);for(let i=0;i<e;i++)n[i]=t.codePointAt(i);return n},Ht=typeof TextEncoder<"u"?new TextEncoder:null,Ss=s=>Ht.encode(s),Cs=Ht?Ss:ks;let te=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});te&&te.decode(new Uint8Array).length===1&&(te=null);const He=s=>s===void 0?null:s;class Es{constructor(){this.map=new Map}setItem(t,e){this.map.set(t,e)}getItem(t){return this.map.get(t)}}let kn=new Es,As=!0;try{typeof localStorage<"u"&&(kn=localStorage,As=!1)}catch{}const Ts=kn,$t=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name),Is=typeof window<"u"&&!$t;typeof navigator<"u"&&/Mac/.test(navigator.platform);let v;const Ds=()=>{if(v===void 0)if($t){v=V();const s=process.argv;let t=null;for(let e=0;e<s.length;e++){const n=s[e];n[0]==="-"?(t!==null&&v.set(t,""),t=n):t!==null&&(v.set(t,n),t=null)}t!==null&&v.set(t,"")}else typeof location=="object"?(v=V(),(location.search||"?").slice(1).split("&").forEach(s=>{if(s.length!==0){const[t,e]=s.split("=");v.set(`--${ze(t,"-")}`,e),v.set(`-${ze(t,"-")}`,e)}})):v=V();return v},Ms=s=>Ds().has(s),Os=s=>He($t?process.env[s.toUpperCase()]:Ts.getItem(s)),vs=s=>Ms("--"+s)||Os(s)!==null;vs("production");const $e=1,Ge=2,ee=4,ne=8,xs=32,Sn=64,at=128,Ls=31,We=63,X=127,Us=2147483647,Ns=Number.MAX_SAFE_INTEGER,Rs=Number.isInteger||(s=>typeof s=="number"&&isFinite(s)&&G(s)===s);class Vs{constructor(t){this.arr=t,this.pos=0}}const Je=s=>new Vs(s);const ht=s=>{let t=0,e=1;for(;;){const n=s.arr[s.pos++];if(t=t+(n&X)*e,e*=128,n<at)return t;if(t>Ns)throw new Error("Integer out of range!")}};const Cn=(s,t,e)=>new Uint8Array(s,t,e);class _t{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const ke=()=>new _t,Fs=s=>{let t=s.cpos;for(let e=0;e<s.bufs.length;e++)t+=s.bufs[e].length;return t},R=s=>{const t=new Uint8Array(Fs(s));let e=0;for(let n=0;n<s.bufs.length;n++){const i=s.bufs[n];t.set(i,e),e+=i.length}return t.set(Cn(s.cbuf.buffer,0,s.cpos),e),t},Bs=(s,t)=>{const e=s.cbuf.length;e-s.cpos<t&&(s.bufs.push(Cn(s.cbuf.buffer,0,s.cpos)),s.cbuf=new Uint8Array(it(e,t)*2),s.cpos=0)},C=(s,t)=>{const e=s.cbuf.length;s.cpos===e&&(s.bufs.push(s.cbuf),s.cbuf=new Uint8Array(e*2),s.cpos=0),s.cbuf[s.cpos++]=t},ce=C,_=(s,t)=>{for(;t>X;)C(s,at|X&t),t=G(t/128);C(s,X&t)},Se=(s,t)=>{const e=ws(t);for(e&&(t=-t),C(s,(t>We?at:0)|(e?Sn:0)|We&t),t=G(t/64);t>0;)C(s,(t>X?at:0)|X&t),t=G(t/128)},he=new Uint8Array(3e4),js=he.length/3,zs=(s,t)=>{if(t.length<js){const e=Ht.encodeInto(t,he).written||0;_(s,e);for(let n=0;n<e;n++)C(s,he[n])}else I(s,Cs(t))},Hs=(s,t)=>{const e=unescape(encodeURIComponent(t)),n=e.length;_(s,n);for(let i=0;i<n;i++)C(s,e.codePointAt(i))},Z=Ht?zs:Hs,Ce=(s,t)=>{const e=s.cbuf.length,n=s.cpos,i=zt(e-n,t.length),r=t.length-i;s.cbuf.set(t.subarray(0,i),n),s.cpos+=i,r>0&&(s.bufs.push(s.cbuf),s.cbuf=new Uint8Array(it(e*2,r)),s.cbuf.set(t.subarray(i)),s.cpos=r)},I=(s,t)=>{_(s,t.byteLength),Ce(s,t)},Ee=(s,t)=>{Bs(s,t);const e=new DataView(s.cbuf.buffer,s.cpos,t);return s.cpos+=t,e},$s=(s,t)=>Ee(s,4).setFloat32(0,t,!1),Gs=(s,t)=>Ee(s,8).setFloat64(0,t,!1),Ws=(s,t)=>Ee(s,8).setBigInt64(0,t,!1),Ye=new DataView(new ArrayBuffer(4)),Js=s=>(Ye.setFloat32(0,s),Ye.getFloat32(0)===s),dt=(s,t)=>{switch(typeof t){case"string":C(s,119),Z(s,t);break;case"number":Rs(t)&&Tt(t)<=Us?(C(s,125),Se(s,t)):Js(t)?(C(s,124),$s(s,t)):(C(s,123),Gs(s,t));break;case"bigint":C(s,122),Ws(s,t);break;case"object":if(t===null)C(s,126);else if(t instanceof Array){C(s,117),_(s,t.length);for(let e=0;e<t.length;e++)dt(s,t[e])}else if(t instanceof Uint8Array)C(s,116),I(s,t);else{C(s,118);const e=Object.keys(t);_(s,e.length);for(let n=0;n<e.length;n++){const i=e[n];Z(s,i),dt(s,t[i])}}break;case"boolean":C(s,t?120:121);break;default:C(s,127)}};class Pe extends _t{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&_(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const qe=s=>{s.count>0&&(Se(s.encoder,s.count===1?s.s:-s.s),s.count>1&&_(s.encoder,s.count-2))};class It{constructor(){this.encoder=new _t,this.s=0,this.count=0}write(t){this.s===t?this.count++:(qe(this),this.count=1,this.s=t)}toUint8Array(){return qe(this),R(this.encoder)}}const Ke=s=>{if(s.count>0){const t=s.diff*2+(s.count===1?0:1);Se(s.encoder,t),s.count>1&&_(s.encoder,s.count-2)}};class se{constructor(){this.encoder=new _t,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(Ke(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return Ke(this),R(this.encoder)}}class Ys{constructor(){this.sarr=[],this.s="",this.lensE=new It}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new _t;return this.sarr.push(this.s),this.s="",Z(t,this.sarr.join("")),Ce(t,this.lensE.toUint8Array()),R(t)}}const Xe=typeof crypto>"u"?null:crypto,Ps=Xe!==null?s=>{const t=new ArrayBuffer(s),e=new Uint8Array(t);return Xe.getRandomValues(e),t}:s=>{const t=new ArrayBuffer(s),e=new Uint8Array(t);for(let n=0;n<s;n++)e[n]=Math.ceil(Math.random()*4294967295>>>0);return t},qs=Math.random,En=()=>new Uint32Array(Ps(4))[0],Ks=s=>s[G(qs()*s.length)],Xs=[1e7]+-1e3+-4e3+-8e3+-1e11,Zs=()=>Xs.replace(/[018]/g,s=>(s^En()&15>>s/4).toString(16)),Qs=Date.now,ti=s=>new Promise(s),Gt=s=>new Error(s),O=()=>{throw Gt("Method unimplemented")},F=()=>{throw Gt("Unexpected case")},An=Object.keys,Ze=s=>An(s).length,ei=(s,t)=>{for(const e in s)if(!t(s[e],e))return!1;return!0},ni=(s,t)=>Object.prototype.hasOwnProperty.call(s,t),si=(s,t)=>s===t||Ze(s)===Ze(t)&&ei(s,(e,n)=>(e!==void 0||ni(t,n))&&t[n]===e),Ae=(s,t,e=0)=>{try{for(;e<s.length;e++)s[e](...t)}finally{e<s.length&&Ae(s,t,e+1)}},z=Symbol;class ii{constructor(t,e){this.left=t,this.right=e}}const N=(s,t)=>new ii(s,t),W=typeof document<"u"?document:{};typeof DOMParser<"u"&&new DOMParser;const ri=s=>fs(s,(t,e)=>`${e}:${t};`).join("");W.ELEMENT_NODE;W.TEXT_NODE;W.CDATA_SECTION_NODE;W.COMMENT_NODE;W.DOCUMENT_NODE;W.DOCUMENT_TYPE_NODE;W.DOCUMENT_FRAGMENT_NODE;const li=s=>class{constructor(e){this._=e}destroy(){s(this._)}},oi=li(clearTimeout),ae=(s,t)=>new oi(setTimeout(t,s)),Te=z(),Ie=z(),Tn=z(),In=z(),Dn=z(),De=z(),Mn=z(),Me=z(),On=z(),ci={[Te]:N("font-weight","bold"),[Ie]:N("font-weight","normal"),[Tn]:N("color","blue"),[Dn]:N("color","green"),[In]:N("color","grey"),[De]:N("color","red"),[Mn]:N("color","purple"),[Me]:N("color","orange"),[On]:N("color","black")},hi={[Te]:"\x1B[1m",[Ie]:"\x1B[2m",[Tn]:"\x1B[34m",[Dn]:"\x1B[32m",[In]:"\x1B[37m",[De]:"\x1B[31m",[Mn]:"\x1B[35m",[Me]:"\x1B[38;5;208m",[On]:"\x1B[0m"},ai=s=>{const t=[],e=[],n=V();let i=[],r=0;for(;r<s.length;r++){const l=s[r],o=ci[l];if(o!==void 0)n.set(o.left,o.right);else if(l.constructor===String||l.constructor===Number){const h=ri(n);r>0||h.length>0?(t.push("%c"+l),e.push(h)):t.push(l)}else break}for(r>0&&(i=e,i.unshift(t.join("")));r<s.length;r++){const l=s[r];l instanceof Symbol||i.push(l)}return i},di=s=>{const t=[],e=[];let n=0;for(;n<s.length;n++){const i=s[n],r=hi[i];if(r!==void 0)t.push(r);else if(i.constructor===String||i.constructor===Number)t.push(i);else break}for(n>0&&(t.push("\x1B[0m"),e.push(t.join("")));n<s.length;n++){const i=s[n];i instanceof Symbol||e.push(i)}return e},ui=$t?di:ai,fi=(...s)=>{console.log(...ui(s)),gi.forEach(t=>t.print(s))},gi=new Set,vn=s=>({[Symbol.iterator](){return this},next:s}),pi=(s,t)=>vn(()=>{let e;do e=s.next();while(!e.done&&!t(e.value));return e}),ie=(s,t)=>vn(()=>{const{done:e,value:n}=s.next();return{done:e,value:e?void 0:t(n)}});class Oe{constructor(t,e){this.clock=t,this.len=e}}class yt{constructor(){this.clients=new Map}}const B=(s,t,e)=>t.clients.forEach((n,i)=>{const r=s.doc.store.clients.get(i);for(let l=0;l<n.length;l++){const o=n[l];Nn(s,r,o.clock,o.len,e)}}),wi=(s,t)=>{let e=0,n=s.length-1;for(;e<=n;){const i=G((e+n)/2),r=s[i],l=r.clock;if(l<=t){if(t<l+r.len)return i;e=i+1}else n=i-1}return null},rt=(s,t)=>{const e=s.clients.get(t.client);return e!==void 0&&wi(e,t.clock)!==null},ve=s=>{s.clients.forEach(t=>{t.sort((i,r)=>i.clock-r.clock);let e,n;for(e=1,n=1;e<t.length;e++){const i=t[n-1],r=t[e];i.clock+i.len>=r.clock?i.len=it(i.len,r.clock+r.len-i.clock):(n<e&&(t[n]=r),n++)}t.length=n})},Ut=s=>{const t=new yt;for(let e=0;e<s.length;e++)s[e].clients.forEach((n,i)=>{if(!t.clients.has(i)){const r=n.slice();for(let l=e+1;l<s.length;l++)ps(r,s[l].clients.get(i)||[]);t.clients.set(i,r)}});return ve(t),t},xe=(s,t,e,n)=>{Y(s.clients,t,()=>[]).push(new Oe(e,n))},Wt=()=>new yt,mi=s=>{const t=Wt();return s.clients.forEach((e,n)=>{const i=[];for(let r=0;r<e.length;r++){const l=e[r];if(l.deleted){const o=l.id.clock;let h=l.length;if(r+1<e.length)for(let c=e[r+1];r+1<e.length&&c.deleted;c=e[++r+1])h+=c.length;i.push(new Oe(o,h))}}i.length>0&&t.clients.set(n,i)}),t},de=(s,t)=>{_(s.restEncoder,t.clients.size),t.clients.forEach((e,n)=>{s.resetDsCurVal(),_(s.restEncoder,n);const i=e.length;_(s.restEncoder,i);for(let r=0;r<i;r++){const l=e[r];s.writeDsClock(l.clock),s.writeDsLen(l.len)}})},Qe=s=>{const t=new yt,e=ht(s.restDecoder);for(let n=0;n<e;n++){s.resetDsCurVal();const i=ht(s.restDecoder),r=ht(s.restDecoder);if(r>0){const l=Y(t.clients,i,()=>[]);for(let o=0;o<r;o++)l.push(new Oe(s.readDsClock(),s.readDsLen()))}}return t},xn=En;class lt extends bn{constructor({guid:t=Zs(),collectionid:e=null,gc:n=!0,gcFilter:i=()=>!0,meta:r=null,autoLoad:l=!1,shouldLoad:o=!0}={}){super(),this.gc=n,this.gcFilter=i,this.clientID=xn(),this.guid=t,this.collectionid=e,this.share=new Map,this.store=new Oi,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=o,this.autoLoad=l,this.meta=r,this.isLoaded=!1,this.whenLoaded=ti(h=>{this.on("load",()=>{this.isLoaded=!0,h(this)})})}load(){const t=this._item;t!==null&&!this.shouldLoad&&y(t.parent.doc,e=>{e.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Array.from(this.subdocs).map(t=>t.guid))}transact(t,e=null){y(this,t,e)}get(t,e=A){const n=Y(this.share,t,()=>{const r=new e;return r._integrate(this,null),r}),i=n.constructor;if(e!==A&&i!==e)if(i===A){const r=new e;r._map=n._map,n._map.forEach(l=>{for(;l!==null;l=l.left)l.parent=r}),r._start=n._start;for(let l=r._start;l!==null;l=l.right)l.parent=r;return r._length=n._length,this.share.set(t,r),r._integrate(this,null),r}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return n}getArray(t=""){return this.get(t,J)}getText(t=""){return this.get(t,et)}getMap(t=""){return this.get(t,wt)}getXmlFragment(t=""){return this.get(t,nt)}toJSON(){const t={};return this.share.forEach((e,n)=>{t[n]=e.toJSON()}),t}destroy(){yn(this.subdocs).forEach(e=>e.destroy());const t=this._item;if(t!==null){this._item=null;const e=t.content;e.doc=new lt({guid:this.guid,...e.opts,shouldLoad:!1}),e.doc._item=t,y(t.parent.doc,n=>{const i=e.doc;t.deleted||n.subdocsAdded.add(i),n.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}on(t,e){super.on(t,e)}off(t,e){super.off(t,e)}}class tn{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return ht(this.restDecoder)}readDsLen(){return ht(this.restDecoder)}}class ue{constructor(){this.restEncoder=ke()}toUint8Array(){return R(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){_(this.restEncoder,t)}writeDsLen(t){_(this.restEncoder,t)}}class _i extends ue{writeLeftID(t){_(this.restEncoder,t.client),_(this.restEncoder,t.clock)}writeRightID(t){_(this.restEncoder,t.client),_(this.restEncoder,t.clock)}writeClient(t){_(this.restEncoder,t)}writeInfo(t){ce(this.restEncoder,t)}writeString(t){Z(this.restEncoder,t)}writeParentInfo(t){_(this.restEncoder,t?1:0)}writeTypeRef(t){_(this.restEncoder,t)}writeLen(t){_(this.restEncoder,t)}writeAny(t){dt(this.restEncoder,t)}writeBuf(t){I(this.restEncoder,t)}writeJSON(t){Z(this.restEncoder,JSON.stringify(t))}writeKey(t){Z(this.restEncoder,t)}}class yi{constructor(){this.restEncoder=ke(),this.dsCurrVal=0}toUint8Array(){return R(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const e=t-this.dsCurrVal;this.dsCurrVal=t,_(this.restEncoder,e)}writeDsLen(t){t===0&&F(),_(this.restEncoder,t-1),this.dsCurrVal+=t}}class bi extends yi{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new se,this.clientEncoder=new It,this.leftClockEncoder=new se,this.rightClockEncoder=new se,this.infoEncoder=new Pe(ce),this.stringEncoder=new Ys,this.parentInfoEncoder=new Pe(ce),this.typeRefEncoder=new It,this.lenEncoder=new It}toUint8Array(){const t=ke();return _(t,0),I(t,this.keyClockEncoder.toUint8Array()),I(t,this.clientEncoder.toUint8Array()),I(t,this.leftClockEncoder.toUint8Array()),I(t,this.rightClockEncoder.toUint8Array()),I(t,R(this.infoEncoder)),I(t,this.stringEncoder.toUint8Array()),I(t,R(this.parentInfoEncoder)),I(t,this.typeRefEncoder.toUint8Array()),I(t,this.lenEncoder.toUint8Array()),Ce(t,R(this.restEncoder)),R(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){dt(this.restEncoder,t)}writeBuf(t){I(this.restEncoder,t)}writeJSON(t){dt(this.restEncoder,t)}writeKey(t){const e=this.keyMap.get(t);e===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(e)}}const ki=(s,t,e,n)=>{n=it(n,t[0].id.clock);const i=j(t,n);_(s.restEncoder,t.length-i),s.writeClient(e),_(s.restEncoder,n);const r=t[i];r.write(s,n-r.id.clock);for(let l=i+1;l<t.length;l++)t[l].write(s,0)},Si=(s,t,e)=>{const n=new Map;e.forEach((i,r)=>{E(t,r)>i&&n.set(r,i)}),Jt(t).forEach((i,r)=>{e.has(r)||n.set(r,0)}),_(s.restEncoder,n.size),Array.from(n.entries()).sort((i,r)=>r[0]-i[0]).forEach(([i,r])=>{ki(s,t.clients.get(i),i,r)})},Ci=(s,t)=>Si(s,t.doc.store,t.beforeState);class Ei{constructor(){this.l=[]}}const en=()=>new Ei,nn=(s,t)=>s.l.push(t),sn=(s,t)=>{const e=s.l,n=e.length;s.l=e.filter(i=>t!==i),n===s.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},Ln=(s,t,e)=>Ae(s.l,[t,e]);class Dt{constructor(t,e){this.client=t,this.clock=e}}const St=(s,t)=>s===t||s!==null&&t!==null&&s.client===t.client&&s.clock===t.clock,m=(s,t)=>new Dt(s,t),ut=s=>{for(const[t,e]of s.doc.share.entries())if(e===s)return t;throw F()},ft=(s,t)=>{for(;t!==null;){if(t.parent===s)return!0;t=t.parent._item}return!1};class Ai{constructor(t,e=t.getMap("users")){const n=new Map;this.yusers=e,this.doc=t,this.clients=new Map,this.dss=n;const i=(r,l)=>{const o=r.get("ds"),h=r.get("ids"),c=a=>this.clients.set(a,l);o.observe(a=>{a.changes.added.forEach(d=>{d.content.getContent().forEach(f=>{f instanceof Uint8Array&&this.dss.set(l,Ut([this.dss.get(l)||Wt(),Qe(new tn(Je(f)))]))})})}),this.dss.set(l,Ut(o.map(a=>Qe(new tn(Je(a)))))),h.observe(a=>a.changes.added.forEach(d=>d.content.getContent().forEach(c))),h.forEach(c)};e.observe(r=>{r.keysChanged.forEach(l=>i(e.get(l),l))}),e.forEach(i)}setUserMapping(t,e,n,{filter:i=()=>!0}={}){const r=this.yusers;let l=r.get(n);l||(l=new wt,l.set("ids",new J),l.set("ds",new J),r.set(n,l)),l.get("ids").push([e]),r.observe(o=>{setTimeout(()=>{const h=r.get(n);if(h!==l){l=h,this.clients.forEach((d,f)=>{n===d&&l.get("ids").push([f])});const c=new ue,a=this.dss.get(n);a&&(de(c,a),l.get("ds").push([c.toUint8Array()]))}},0)}),t.on("afterTransaction",o=>{setTimeout(()=>{const h=l.get("ds"),c=o.deleteSet;if(o.local&&c.clients.size>0&&i(o,c)){const a=new ue;de(a,c),h.push([a.toUint8Array()])}})})}getUserByClientId(t){return this.clients.get(t)||null}getUserByDeletedId(t){for(const[e,n]of this.dss.entries())if(rt(n,t))return e;return null}}class Nt{constructor(t,e,n,i=0){this.type=t,this.tname=e,this.item=n,this.assoc=i}}class Ti{constructor(t,e,n=0){this.type=t,this.index=e,this.assoc=n}}const Ii=(s,t,e=0)=>new Ti(s,t,e),Ct=(s,t,e)=>{let n=null,i=null;return s._item===null?i=ut(s):n=m(s._item.id.client,s._item.id.clock),new Nt(n,i,t,e)},re=(s,t,e=0)=>{let n=s._start;if(e<0){if(t===0)return Ct(s,null,e);t--}for(;n!==null;){if(!n.deleted&&n.countable){if(n.length>t)return Ct(s,m(n.id.client,n.id.clock+t),e);t-=n.length}if(n.right===null&&e<0)return Ct(s,n.lastId,e);n=n.right}return Ct(s,null,e)},Di=(s,t)=>{const e=t.store,n=s.item,i=s.type,r=s.tname,l=s.assoc;let o=null,h=0;if(n!==null){if(E(e,n.client)<=n.clock)return null;const c=pe(e,n),a=c.item;if(!(a instanceof b))return null;if(o=a.parent,o._item===null||!o._item.deleted){h=a.deleted||!a.countable?0:c.diff+(l>=0?0:1);let d=a.left;for(;d!==null;)!d.deleted&&d.countable&&(h+=d.length),d=d.left}}else{if(r!==null)o=t.get(r);else if(i!==null){if(E(e,i.client)<=i.clock)return null;const{item:c}=pe(e,i);if(c instanceof b&&c.content instanceof L)o=c.content.type;else return null}else throw F();l>=0?h=o._length:h=0}return Ii(o,h,s.assoc)};class Le{constructor(t,e){this.ds=t,this.sv=e}}const Ue=(s,t)=>new Le(s,t);Ue(Wt(),new Map);const Mi=s=>Ue(mi(s.store),Jt(s.store)),K=(s,t)=>t===void 0?!s.deleted:t.sv.has(s.id.client)&&(t.sv.get(s.id.client)||0)>s.id.clock&&!rt(t.ds,s.id),Mt=(s,t)=>{const e=Y(s.meta,Mt,tt),n=s.doc.store;e.has(t)||(t.sv.forEach((i,r)=>{i<E(n,r)&&T(s,m(r,i))}),B(s,t.ds,i=>{}),e.add(t))};class Oi{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Jt=s=>{const t=new Map;return s.clients.forEach((e,n)=>{const i=e[e.length-1];t.set(n,i.id.clock+i.length)}),t},E=(s,t)=>{const e=s.clients.get(t);if(e===void 0)return 0;const n=e[e.length-1];return n.id.clock+n.length},Un=(s,t)=>{let e=s.clients.get(t.id.client);if(e===void 0)e=[],s.clients.set(t.id.client,e);else{const n=e[e.length-1];if(n.id.clock+n.length!==t.id.clock)throw F()}e.push(t)},j=(s,t)=>{let e=0,n=s.length-1,i=s[n],r=i.id.clock;if(r===t)return n;let l=G(t/(r+i.length-1)*n);for(;e<=n;){if(i=s[l],r=i.id.clock,r<=t){if(t<r+i.length)return l;e=l+1}else n=l-1;l=G((e+n)/2)}throw F()},vi=(s,t)=>{const e=s.clients.get(t.client);return e[j(e,t.clock)]},Ot=vi,fe=(s,t,e)=>{const n=j(t,e),i=t[n];return i.id.clock<e&&i instanceof b?(t.splice(n+1,0,ts(s,i,e-i.id.clock)),n+1):n},T=(s,t)=>{const e=s.doc.store.clients.get(t.client);return e[fe(s,e,t.clock)]},rn=(s,t,e)=>{const n=t.clients.get(e.client),i=j(n,e.clock),r=n[i];return e.clock!==r.id.clock+r.length-1&&r.constructor!==H&&n.splice(i+1,0,ts(s,r,e.clock-r.id.clock+1)),r},xi=(s,t,e)=>{const n=s.clients.get(t.id.client);n[j(n,t.id.clock)]=e},Nn=(s,t,e,n,i)=>{if(n===0)return;const r=e+n;let l=fe(s,t,e),o;do o=t[l++],r<o.id.clock+o.length&&fe(s,t,r),i(o);while(l<t.length&&t[l].id.clock<r)};class Li{constructor(t,e,n){this.doc=t,this.deleteSet=new yt,this.beforeState=Jt(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=e,this.meta=new Map,this.local=n,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set}}const ln=(s,t)=>t.deleteSet.clients.size===0&&!gs(t.afterState,(e,n)=>t.beforeState.get(n)!==e)?!1:(ve(t.deleteSet),Ci(s,t),de(s,t.deleteSet),!0),on=(s,t,e)=>{const n=t._item;(n===null||n.id.clock<(s.beforeState.get(n.id.client)||0)&&!n.deleted)&&Y(s.changed,t,tt).add(e)},vt=(s,t)=>{const e=s[t-1],n=s[t];e.deleted===n.deleted&&e.constructor===n.constructor&&e.mergeWith(n)&&(s.splice(t,1),n instanceof b&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,e))},Ui=(s,t,e)=>{for(const[n,i]of s.clients.entries()){const r=t.clients.get(n);for(let l=i.length-1;l>=0;l--){const o=i[l],h=o.clock+o.len;for(let c=j(r,o.clock),a=r[c];c<r.length&&a.id.clock<h;a=r[++c]){const d=r[c];if(o.clock+o.len<=d.id.clock)break;d instanceof b&&d.deleted&&!d.keep&&e(d)&&d.gc(t,!1)}}}},Ni=(s,t)=>{s.clients.forEach((e,n)=>{const i=t.clients.get(n);for(let r=e.length-1;r>=0;r--){const l=e[r],o=zt(i.length-1,1+j(i,l.clock+l.len-1));for(let h=o,c=i[h];h>0&&c.id.clock>=l.clock;c=i[--h])vt(i,h)}})},Rn=(s,t)=>{if(t<s.length){const e=s[t],n=e.doc,i=n.store,r=e.deleteSet,l=e._mergeStructs;try{ve(r),e.afterState=Jt(e.doc.store),n._transaction=null,n.emit("beforeObserverCalls",[e,n]);const o=[];e.changed.forEach((h,c)=>o.push(()=>{(c._item===null||!c._item.deleted)&&c._callObserver(e,h)})),o.push(()=>{e.changedParentTypes.forEach((h,c)=>o.push(()=>{(c._item===null||!c._item.deleted)&&(h=h.filter(a=>a.target._item===null||!a.target._item.deleted),h.forEach(a=>{a.currentTarget=c}),h.sort((a,d)=>a.path.length-d.path.length),Ln(c._dEH,h,e))})),o.push(()=>n.emit("afterTransaction",[e,n]))}),Ae(o,[])}finally{n.gc&&Ui(r,i,n.gcFilter),Ni(r,i),e.afterState.forEach((a,d)=>{const f=e.beforeState.get(d)||0;if(f!==a){const u=i.clients.get(d),g=it(j(u,f),1);for(let w=u.length-1;w>=g;w--)vt(u,w)}});for(let a=0;a<l.length;a++){const{client:d,clock:f}=l[a].id,u=i.clients.get(d),g=j(u,f);g+1<u.length&&vt(u,g+1),g>0&&vt(u,g)}if(!e.local&&e.afterState.get(n.clientID)!==e.beforeState.get(n.clientID)&&(fi(Me,Te,"[yjs] ",Ie,De,"Changed the client-id because another client seems to be using it."),n.clientID=xn()),n.emit("afterTransactionCleanup",[e,n]),n._observers.has("update")){const a=new _i;ln(a,e)&&n.emit("update",[a.toUint8Array(),e.origin,n,e])}if(n._observers.has("updateV2")){const a=new bi;ln(a,e)&&n.emit("updateV2",[a.toUint8Array(),e.origin,n,e])}const{subdocsAdded:o,subdocsLoaded:h,subdocsRemoved:c}=e;(o.size>0||c.size>0||h.size>0)&&(o.forEach(a=>{a.clientID=n.clientID,a.collectionid==null&&(a.collectionid=n.collectionid),n.subdocs.add(a)}),c.forEach(a=>n.subdocs.delete(a)),n.emit("subdocs",[{loaded:h,added:o,removed:c},n,e]),c.forEach(a=>a.destroy())),s.length<=t+1?(n._transactionCleanups=[],n.emit("afterAllTransactions",[n,s])):Rn(s,t+1)}}},y=(s,t,e=null,n=!0)=>{const i=s._transactionCleanups;let r=!1;s._transaction===null&&(r=!0,s._transaction=new Li(s,e,n),i.push(s._transaction),i.length===1&&s.emit("beforeAllTransactions",[s]),s.emit("beforeTransaction",[s._transaction,s]));try{t(s._transaction)}finally{r&&i[0]===s._transaction&&Rn(i,0)}};class Ri{constructor(t,e){this.insertions=e,this.deletions=t,this.meta=new Map}}const cn=(s,t,e)=>{B(s,e.deletions,n=>{n instanceof b&&t.scope.some(i=>ft(i,n))&&Fe(n,!1)})},hn=(s,t,e)=>{let n=null,i=null;const r=s.doc,l=s.scope;if(y(r,o=>{for(;t.length>0&&n===null;){const h=r.store,c=t.pop(),a=new Set,d=[];let f=!1;B(o,c.insertions,u=>{if(u instanceof b){if(u.redone!==null){let{item:g,diff:w}=pe(h,u.id);w>0&&(g=T(o,m(g.id.client,g.id.clock+w))),u=g}!u.deleted&&l.some(g=>ft(g,u))&&d.push(u)}}),B(o,c.deletions,u=>{u instanceof b&&l.some(g=>ft(g,u))&&!rt(c.insertions,u.id)&&a.add(u)}),a.forEach(u=>{f=es(o,u,a,c.insertions,s.ignoreRemoteMapChanges)!==null||f});for(let u=d.length-1;u>=0;u--){const g=d[u];s.deleteFilter(g)&&(g.delete(o),f=!0)}n=f?c:null}o.changed.forEach((h,c)=>{h.has(null)&&c._searchMarker&&(c._searchMarker.length=0)}),i=o},s),n!=null){const o=i.changedParentTypes;s.emit("stack-item-popped",[{stackItem:n,type:e,changedParentTypes:o},s])}return n};class Vi extends bn{constructor(t,{captureTimeout:e=500,captureTransaction:n=h=>!0,deleteFilter:i=()=>!0,trackedOrigins:r=new Set([null]),ignoreRemoteMapChanges:l=!1,doc:o=je(t)?t[0].doc:t.doc}={}){super(),this.scope=[],this.addToScope(t),this.deleteFilter=i,r.add(this),this.trackedOrigins=r,this.captureTransaction=n,this.undoStack=[],this.redoStack=[],this.undoing=!1,this.redoing=!1,this.doc=o,this.lastChange=0,this.ignoreRemoteMapChanges=l,this.afterTransactionHandler=h=>{if(!this.captureTransaction(h)||!this.scope.some(p=>h.changedParentTypes.has(p))||!this.trackedOrigins.has(h.origin)&&(!h.origin||!this.trackedOrigins.has(h.origin.constructor)))return;const c=this.undoing,a=this.redoing,d=c?this.redoStack:this.undoStack;c?this.stopCapturing():a||this.clear(!1,!0);const f=new yt;h.afterState.forEach((p,U)=>{const P=h.beforeState.get(U)||0,q=p-P;q>0&&xe(f,U,P,q)});const u=Qs();let g=!1;if(u-this.lastChange<e&&d.length>0&&!c&&!a){const p=d[d.length-1];p.deletions=Ut([p.deletions,h.deleteSet]),p.insertions=Ut([p.insertions,f])}else d.push(new Ri(h.deleteSet,f)),g=!0;!c&&!a&&(this.lastChange=u),B(h,h.deleteSet,p=>{p instanceof b&&this.scope.some(U=>ft(U,p))&&Fe(p,!0)});const w=[{stackItem:d[d.length-1],origin:h.origin,type:c?"redo":"undo",changedParentTypes:h.changedParentTypes},this];g?this.emit("stack-item-added",w):this.emit("stack-item-updated",w)},this.doc.on("afterTransaction",this.afterTransactionHandler),this.doc.on("destroy",()=>{this.destroy()})}addToScope(t){t=je(t)?t:[t],t.forEach(e=>{this.scope.every(n=>n!==e)&&this.scope.push(e)})}addTrackedOrigin(t){this.trackedOrigins.add(t)}removeTrackedOrigin(t){this.trackedOrigins.delete(t)}clear(t=!0,e=!0){(t&&this.canUndo()||e&&this.canRedo())&&this.doc.transact(n=>{t&&(this.undoStack.forEach(i=>cn(n,this,i)),this.undoStack=[]),e&&(this.redoStack.forEach(i=>cn(n,this,i)),this.redoStack=[]),this.emit("stack-cleared",[{undoStackCleared:t,redoStackCleared:e}])})}stopCapturing(){this.lastChange=0}undo(){this.undoing=!0;let t;try{t=hn(this,this.undoStack,"undo")}finally{this.undoing=!1}return t}redo(){this.redoing=!0;let t;try{t=hn(this,this.redoStack,"redo")}finally{this.redoing=!1}return t}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}destroy(){this.trackedOrigins.delete(this),this.doc.off("afterTransaction",this.afterTransactionHandler),super.destroy()}}class Yt{constructor(t,e){this.target=t,this.currentTarget=t,this.transaction=e,this._changes=null,this._keys=null,this._delta=null}get path(){return Fi(this.currentTarget,this.target)}deletes(t){return rt(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){const t=new Map,e=this.target;this.transaction.changed.get(e).forEach(i=>{if(i!==null){const r=e._map.get(i);let l,o;if(this.adds(r)){let h=r.left;for(;h!==null&&this.adds(h);)h=h.left;if(this.deletes(r))if(h!==null&&this.deletes(h))l="delete",o=Qt(h.content.getContent());else return;else h!==null&&this.deletes(h)?(l="update",o=Qt(h.content.getContent())):(l="add",o=void 0)}else if(this.deletes(r))l="delete",o=Qt(r.content.getContent());else return;t.set(i,{action:l,oldValue:o})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){const e=this.target,n=tt(),i=tt(),r=[];if(t={added:n,deleted:i,delta:r,keys:this.keys},this.transaction.changed.get(e).has(null)){let o=null;const h=()=>{o&&r.push(o)};for(let c=e._start;c!==null;c=c.right)c.deleted?this.deletes(c)&&!this.adds(c)&&((o===null||o.delete===void 0)&&(h(),o={delete:0}),o.delete+=c.length,i.add(c)):this.adds(c)?((o===null||o.insert===void 0)&&(h(),o={insert:[]}),o.insert=o.insert.concat(c.content.getContent()),n.add(c)):((o===null||o.retain===void 0)&&(h(),o={retain:0}),o.retain+=c.length);o!==null&&o.retain===void 0&&h()}this._changes=t}return t}}const Fi=(s,t)=>{const e=[];for(;t._item!==null&&t!==s;){if(t._item.parentSub!==null)e.unshift(t._item.parentSub);else{let n=0,i=t._item.parent._start;for(;i!==t._item&&i!==null;)i.deleted||n++,i=i.right;e.unshift(n)}t=t._item.parent}return e},Vn=80;let Ne=0;class Bi{constructor(t,e){t.marker=!0,this.p=t,this.index=e,this.timestamp=Ne++}}const ji=s=>{s.timestamp=Ne++},Fn=(s,t,e)=>{s.p.marker=!1,s.p=t,t.marker=!0,s.index=e,s.timestamp=Ne++},zi=(s,t,e)=>{if(s.length>=Vn){const n=s.reduce((i,r)=>i.timestamp<r.timestamp?i:r);return Fn(n,t,e),n}else{const n=new Bi(t,e);return s.push(n),n}},Pt=(s,t)=>{if(s._start===null||t===0||s._searchMarker===null)return null;const e=s._searchMarker.length===0?null:s._searchMarker.reduce((r,l)=>Tt(t-r.index)<Tt(t-l.index)?r:l);let n=s._start,i=0;for(e!==null&&(n=e.p,i=e.index,ji(e));n.right!==null&&i<t;){if(!n.deleted&&n.countable){if(t<i+n.length)break;i+=n.length}n=n.right}for(;n.left!==null&&i>t;)n=n.left,!n.deleted&&n.countable&&(i-=n.length);for(;n.left!==null&&n.left.id.client===n.id.client&&n.left.id.clock+n.left.length===n.id.clock;)n=n.left,!n.deleted&&n.countable&&(i-=n.length);return e!==null&&Tt(e.index-i)<n.parent.length/Vn?(Fn(e,n,i),e):zi(s._searchMarker,n,i)},gt=(s,t,e)=>{for(let n=s.length-1;n>=0;n--){const i=s[n];if(e>0){let r=i.p;for(r.marker=!1;r&&(r.deleted||!r.countable);)r=r.left,r&&!r.deleted&&r.countable&&(i.index-=r.length);if(r===null||r.marker===!0){s.splice(n,1);continue}i.p=r,r.marker=!0}(t<i.index||e>0&&t===i.index)&&(i.index=it(t,i.index+e))}},qt=(s,t,e)=>{const n=s,i=t.changedParentTypes;for(;Y(i,s,()=>[]).push(e),s._item!==null;)s=s._item.parent;Ln(n._eH,e,t)};class A{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=en(),this._dEH=en(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,e){this.doc=t,this._item=e}_copy(){throw O()}clone(){throw O()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,e){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){nn(this._eH,t)}observeDeep(t){nn(this._dEH,t)}unobserve(t){sn(this._eH,t)}unobserveDeep(t){sn(this._dEH,t)}toJSON(){}}const Bn=(s,t,e)=>{t<0&&(t=s._length+t),e<0&&(e=s._length+e);let n=e-t;const i=[];let r=s._start;for(;r!==null&&n>0;){if(r.countable&&!r.deleted){const l=r.content.getContent();if(l.length<=t)t-=l.length;else{for(let o=t;o<l.length&&n>0;o++)i.push(l[o]),n--;t=0}}r=r.right}return i},jn=s=>{const t=[];let e=s._start;for(;e!==null;){if(e.countable&&!e.deleted){const n=e.content.getContent();for(let i=0;i<n.length;i++)t.push(n[i])}e=e.right}return t},zn=(s,t)=>{const e=[];let n=s._start;for(;n!==null;){if(n.countable&&K(n,t)){const i=n.content.getContent();for(let r=0;r<i.length;r++)e.push(i[r])}n=n.right}return e},pt=(s,t)=>{let e=0,n=s._start;for(;n!==null;){if(n.countable&&!n.deleted){const i=n.content.getContent();for(let r=0;r<i.length;r++)t(i[r],e++,s)}n=n.right}},Hn=(s,t)=>{const e=[];return pt(s,(n,i)=>{e.push(t(n,i,s))}),e},Hi=s=>{let t=s._start,e=null,n=0;return{[Symbol.iterator](){return this},next:()=>{if(e===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};e=t.content.getContent(),n=0,t=t.right}const i=e[n++];return e.length<=n&&(e=null),{done:!1,value:i}}}},$n=(s,t)=>{const e=Pt(s,t);let n=s._start;for(e!==null&&(n=e.p,t-=e.index);n!==null;n=n.right)if(!n.deleted&&n.countable){if(t<n.length)return n.content.getContent()[t];t-=n.length}},Rt=(s,t,e,n)=>{let i=e;const r=s.doc,l=r.clientID,o=r.store,h=e===null?t._start:e.right;let c=[];const a=()=>{c.length>0&&(i=new b(m(l,E(o,l)),i,i&&i.lastId,h,h&&h.id,t,null,new st(c)),i.integrate(s,0),c=[])};n.forEach(d=>{if(d===null)c.push(d);else switch(d.constructor){case Number:case Object:case Boolean:case Array:case String:c.push(d);break;default:switch(a(),d.constructor){case Uint8Array:case ArrayBuffer:i=new b(m(l,E(o,l)),i,i&&i.lastId,h,h&&h.id,t,null,new Kt(new Uint8Array(d))),i.integrate(s,0);break;case lt:i=new b(m(l,E(o,l)),i,i&&i.lastId,h,h&&h.id,t,null,new Xt(d)),i.integrate(s,0);break;default:if(d instanceof A)i=new b(m(l,E(o,l)),i,i&&i.lastId,h,h&&h.id,t,null,new L(d)),i.integrate(s,0);else throw new Error("Unexpected content type in insert operation")}}}),a()},Gn=Gt("Length exceeded!"),Wn=(s,t,e,n)=>{if(e>t._length)throw Gn;if(e===0)return t._searchMarker&&gt(t._searchMarker,e,n.length),Rt(s,t,null,n);const i=e,r=Pt(t,e);let l=t._start;for(r!==null&&(l=r.p,e-=r.index,e===0&&(l=l.prev,e+=l&&l.countable&&!l.deleted?l.length:0));l!==null;l=l.right)if(!l.deleted&&l.countable){if(e<=l.length){e<l.length&&T(s,m(l.id.client,l.id.clock+e));break}e-=l.length}return t._searchMarker&&gt(t._searchMarker,i,n.length),Rt(s,t,l,n)},$i=(s,t,e)=>{let i=(t._searchMarker||[]).reduce((r,l)=>l.index>r.index?l:r,{index:0,p:t._start}).p;if(i)for(;i.right;)i=i.right;return Rt(s,t,i,e)},Jn=(s,t,e,n)=>{if(n===0)return;const i=e,r=n,l=Pt(t,e);let o=t._start;for(l!==null&&(o=l.p,e-=l.index);o!==null&&e>0;o=o.right)!o.deleted&&o.countable&&(e<o.length&&T(s,m(o.id.client,o.id.clock+e)),e-=o.length);for(;n>0&&o!==null;)o.deleted||(n<o.length&&T(s,m(o.id.client,o.id.clock+n)),o.delete(s),n-=o.length),o=o.right;if(n>0)throw Gn;t._searchMarker&&gt(t._searchMarker,i,-r+n)},Vt=(s,t,e)=>{const n=t._map.get(e);n!==void 0&&n.delete(s)},Re=(s,t,e,n)=>{const i=t._map.get(e)||null,r=s.doc,l=r.clientID;let o;if(n==null)o=new st([n]);else switch(n.constructor){case Number:case Object:case Boolean:case Array:case String:o=new st([n]);break;case Uint8Array:o=new Kt(n);break;case lt:o=new Xt(n);break;default:if(n instanceof A)o=new L(n);else throw new Error("Unexpected content type")}new b(m(l,E(r.store,l)),i,i&&i.lastId,null,null,t,e,o).integrate(s,0)},Ve=(s,t)=>{const e=s._map.get(t);return e!==void 0&&!e.deleted?e.content.getContent()[e.length-1]:void 0},Yn=s=>{const t={};return s._map.forEach((e,n)=>{e.deleted||(t[n]=e.content.getContent()[e.length-1])}),t},Pn=(s,t)=>{const e=s._map.get(t);return e!==void 0&&!e.deleted},Et=s=>pi(s.entries(),t=>!t[1].deleted);class Gi extends Yt{constructor(t,e){super(t,e),this._transaction=e}}class J extends A{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const e=new J;return e.push(t),e}_integrate(t,e){super._integrate(t,e),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new J}clone(){const t=new J;return t.insert(0,this.toArray().map(e=>e instanceof A?e.clone():e)),t}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}_callObserver(t,e){super._callObserver(t,e),qt(this,t,new Gi(this,t))}insert(t,e){this.doc!==null?y(this.doc,n=>{Wn(n,this,t,e)}):this._prelimContent.splice(t,0,...e)}push(t){this.doc!==null?y(this.doc,e=>{$i(e,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,e=1){this.doc!==null?y(this.doc,n=>{Jn(n,this,t,e)}):this._prelimContent.splice(t,e)}get(t){return $n(this,t)}toArray(){return jn(this)}slice(t=0,e=this.length){return Bn(this,t,e)}toJSON(){return this.map(t=>t instanceof A?t.toJSON():t)}map(t){return Hn(this,t)}forEach(t){pt(this,t)}[Symbol.iterator](){return Hi(this)}_write(t){t.writeTypeRef(Zi)}}class Wi extends Yt{constructor(t,e,n){super(t,e),this.keysChanged=n}}class wt extends A{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,e){super._integrate(t,e),this._prelimContent.forEach((n,i)=>{this.set(i,n)}),this._prelimContent=null}_copy(){return new wt}clone(){const t=new wt;return this.forEach((e,n)=>{t.set(n,e instanceof A?e.clone():e)}),t}_callObserver(t,e){qt(this,t,new Wi(this,t,e))}toJSON(){const t={};return this._map.forEach((e,n)=>{if(!e.deleted){const i=e.content.getContent()[e.length-1];t[n]=i instanceof A?i.toJSON():i}}),t}get size(){return[...Et(this._map)].length}keys(){return ie(Et(this._map),t=>t[0])}values(){return ie(Et(this._map),t=>t[1].content.getContent()[t[1].length-1])}entries(){return ie(Et(this._map),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){const e={};return this._map.forEach((n,i)=>{n.deleted||t(n.content.getContent()[n.length-1],i,this)}),e}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?y(this.doc,e=>{Vt(e,this,t)}):this._prelimContent.delete(t)}set(t,e){return this.doc!==null?y(this.doc,n=>{Re(n,this,t,e)}):this._prelimContent.set(t,e),e}get(t){return Ve(this,t)}has(t){return Pn(this,t)}clear(){this.doc!==null?y(this.doc,t=>{this.forEach(function(e,n,i){Vt(t,i,n)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(Qi)}}const $=(s,t)=>s===t||typeof s=="object"&&typeof t=="object"&&s&&t&&si(s,t);class ge{constructor(t,e,n,i){this.left=t,this.right=e,this.index=n,this.currentAttributes=i}forward(){switch(this.right===null&&F(),this.right.content.constructor){case S:this.right.deleted||ot(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const an=(s,t,e)=>{for(;t.right!==null&&e>0;){switch(t.right.content.constructor){case S:t.right.deleted||ot(t.currentAttributes,t.right.content);break;default:t.right.deleted||(e<t.right.length&&T(s,m(t.right.id.client,t.right.id.clock+e)),t.index+=t.right.length,e-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},At=(s,t,e)=>{const n=new Map,i=Pt(t,e);if(i){const r=new ge(i.p.left,i.p,i.index,n);return an(s,r,e-i.index)}else{const r=new ge(null,t._start,0,n);return an(s,r,e)}},qn=(s,t,e,n)=>{for(;e.right!==null&&(e.right.deleted===!0||e.right.content.constructor===S&&$(n.get(e.right.content.key),e.right.content.value));)e.right.deleted||n.delete(e.right.content.key),e.forward();const i=s.doc,r=i.clientID;n.forEach((l,o)=>{const h=e.left,c=e.right,a=new b(m(r,E(i.store,r)),h,h&&h.lastId,c,c&&c.id,t,null,new S(o,l));a.integrate(s,0),e.right=a,e.forward()})},ot=(s,t)=>{const{key:e,value:n}=t;n===null?s.delete(e):s.set(e,n)},Kn=(s,t)=>{for(;s.right!==null;){if(!(s.right.deleted||s.right.content.constructor===S&&$(t[s.right.content.key]||null,s.right.content.value)))break;s.forward()}},Xn=(s,t,e,n)=>{const i=s.doc,r=i.clientID,l=new Map;for(const o in n){const h=n[o],c=e.currentAttributes.get(o)||null;if(!$(c,h)){l.set(o,c);const{left:a,right:d}=e;e.right=new b(m(r,E(i.store,r)),a,a&&a.lastId,d,d&&d.id,t,null,new S(o,h)),e.right.integrate(s,0),e.forward()}}return l},le=(s,t,e,n,i)=>{e.currentAttributes.forEach((f,u)=>{i[u]===void 0&&(i[u]=null)});const r=s.doc,l=r.clientID;Kn(e,i);const o=Xn(s,t,e,i),h=n.constructor===String?new x(n):n instanceof A?new L(n):new ct(n);let{left:c,right:a,index:d}=e;t._searchMarker&&gt(t._searchMarker,e.index,h.getLength()),a=new b(m(l,E(r.store,l)),c,c&&c.lastId,a,a&&a.id,t,null,h),a.integrate(s,0),e.right=a,e.index=d,e.forward(),qn(s,t,e,o)},dn=(s,t,e,n,i)=>{const r=s.doc,l=r.clientID;Kn(e,i);const o=Xn(s,t,e,i);t:for(;e.right!==null&&(n>0||o.size>0&&(e.right.deleted||e.right.content.constructor===S));){if(!e.right.deleted)switch(e.right.content.constructor){case S:{const{key:h,value:c}=e.right.content,a=i[h];if(a!==void 0){if($(a,c))o.delete(h);else{if(n===0)break t;o.set(h,c)}e.right.delete(s)}else e.currentAttributes.set(h,c);break}default:n<e.right.length&&T(s,m(e.right.id.client,e.right.id.clock+n)),n-=e.right.length;break}e.forward()}if(n>0){let h="";for(;n>0;n--)h+=`
`;e.right=new b(m(l,E(r.store,l)),e.left,e.left&&e.left.lastId,e.right,e.right&&e.right.id,t,null,new x(h)),e.right.integrate(s,0),e.forward()}qn(s,t,e,o)},Zn=(s,t,e,n,i)=>{let r=e;const l=Lt(i);for(;r&&(!r.countable||r.deleted);)!r.deleted&&r.content.constructor===S&&ot(l,r.content),r=r.right;let o=0,h=!1;for(;t!==r;){if(e===t&&(h=!0),!t.deleted){const c=t.content;switch(c.constructor){case S:{const{key:a,value:d}=c;((l.get(a)||null)!==d||(n.get(a)||null)===d)&&(t.delete(s),o++,!h&&(i.get(a)||null)===d&&(n.get(a)||null)!==d&&i.delete(a));break}}}t=t.right}return o},Ji=(s,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const e=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===S){const n=t.content.key;e.has(n)?t.delete(s):e.add(n)}t=t.left}},Yi=s=>{let t=0;return y(s.doc,e=>{let n=s._start,i=s._start,r=V();const l=Lt(r);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case S:ot(l,i.content);break;default:t+=Zn(e,n,i,r,l),r=Lt(l),n=i;break}i=i.right}}),t},un=(s,t,e)=>{const n=e,i=Lt(t.currentAttributes),r=t.right;for(;e>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case L:case ct:case x:e<t.right.length&&T(s,m(t.right.id.client,t.right.id.clock+e)),e-=t.right.length,t.right.delete(s);break}t.forward()}r&&Zn(s,r,t.right,i,t.currentAttributes);const l=(t.left||t.right).parent;return l._searchMarker&&gt(l._searchMarker,t.index,-n+e),t};class Pi extends Yt{constructor(t,e,n){super(t,e),this.childListChanged=!1,this.keysChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){const t=this.target.doc,e=[];y(t,n=>{const i=new Map,r=new Map;let l=this.target._start,o=null;const h={};let c="",a=0,d=0;const f=()=>{if(o!==null){let u;switch(o){case"delete":u={delete:d},d=0;break;case"insert":u={insert:c},i.size>0&&(u.attributes={},i.forEach((g,w)=>{g!==null&&(u.attributes[w]=g)})),c="";break;case"retain":if(u={retain:a},Object.keys(h).length>0){u.attributes={};for(const g in h)u.attributes[g]=h[g]}a=0;break}e.push(u),o=null}};for(;l!==null;){switch(l.content.constructor){case L:case ct:this.adds(l)?this.deletes(l)||(f(),o="insert",c=l.content.getContent()[0],f()):this.deletes(l)?(o!=="delete"&&(f(),o="delete"),d+=1):l.deleted||(o!=="retain"&&(f(),o="retain"),a+=1);break;case x:this.adds(l)?this.deletes(l)||(o!=="insert"&&(f(),o="insert"),c+=l.content.str):this.deletes(l)?(o!=="delete"&&(f(),o="delete"),d+=l.length):l.deleted||(o!=="retain"&&(f(),o="retain"),a+=l.length);break;case S:{const{key:u,value:g}=l.content;if(this.adds(l)){if(!this.deletes(l)){const w=i.get(u)||null;$(w,g)?g!==null&&l.delete(n):(o==="retain"&&f(),$(g,r.get(u)||null)?delete h[u]:h[u]=g)}}else if(this.deletes(l)){r.set(u,g);const w=i.get(u)||null;$(w,g)||(o==="retain"&&f(),h[u]=w)}else if(!l.deleted){r.set(u,g);const w=h[u];w!==void 0&&($(w,g)?w!==null&&l.delete(n):(o==="retain"&&f(),g===null?delete h[u]:h[u]=g))}l.deleted||(o==="insert"&&f(),ot(i,l.content));break}}l=l.right}for(f();e.length>0;){const u=e[e.length-1];if(u.retain!==void 0&&u.attributes===void 0)e.pop();else break}}),this._delta=e}return this._delta}}class et extends A{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[]}get length(){return this._length}_integrate(t,e){super._integrate(t,e);try{this._pending.forEach(n=>n())}catch(n){console.error(n)}this._pending=null}_copy(){return new et}clone(){const t=new et;return t.applyDelta(this.toDelta()),t}_callObserver(t,e){super._callObserver(t,e);const n=new Pi(this,t,e),i=t.doc;if(qt(this,t,n),!t.local){let r=!1;for(const[l,o]of t.afterState.entries()){const h=t.beforeState.get(l)||0;if(o!==h&&(Nn(t,i.store.clients.get(l),h,o,c=>{!c.deleted&&c.content.constructor===S&&(r=!0)}),r))break}r||B(t,t.deleteSet,l=>{l instanceof H||r||l.parent===this&&l.content.constructor===S&&(r=!0)}),y(i,l=>{r?Yi(this):B(l,l.deleteSet,o=>{o instanceof H||o.parent===this&&Ji(l,o)})})}}toString(){let t="",e=this._start;for(;e!==null;)!e.deleted&&e.countable&&e.content.constructor===x&&(t+=e.content.str),e=e.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:e=!0}={}){this.doc!==null?y(this.doc,n=>{const i=new ge(null,this._start,0,new Map);for(let r=0;r<t.length;r++){const l=t[r];if(l.insert!==void 0){const o=!e&&typeof l.insert=="string"&&r===t.length-1&&i.right===null&&l.insert.slice(-1)===`
`?l.insert.slice(0,-1):l.insert;(typeof o!="string"||o.length>0)&&le(n,this,i,o,l.attributes||{})}else l.retain!==void 0?dn(n,this,i,l.retain,l.attributes||{}):l.delete!==void 0&&un(n,i,l.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,e,n){const i=[],r=new Map,l=this.doc;let o="",h=this._start;function c(){if(o.length>0){const a={};let d=!1;r.forEach((u,g)=>{d=!0,a[g]=u});const f={insert:o};d&&(f.attributes=a),i.push(f),o=""}}return y(l,a=>{for(t&&Mt(a,t),e&&Mt(a,e);h!==null;){if(K(h,t)||e!==void 0&&K(h,e))switch(h.content.constructor){case x:{const d=r.get("ychange");t!==void 0&&!K(h,t)?(d===void 0||d.user!==h.id.client||d.state!=="removed")&&(c(),r.set("ychange",n?n("removed",h.id):{type:"removed"})):e!==void 0&&!K(h,e)?(d===void 0||d.user!==h.id.client||d.state!=="added")&&(c(),r.set("ychange",n?n("added",h.id):{type:"added"})):d!==void 0&&(c(),r.delete("ychange")),o+=h.content.str;break}case L:case ct:{c();const d={insert:h.content.getContent()[0]};if(r.size>0){const f={};d.attributes=f,r.forEach((u,g)=>{f[g]=u})}i.push(d);break}case S:K(h,t)&&(c(),ot(r,h.content));break}h=h.right}c()},Mt),i}insert(t,e,n){if(e.length<=0)return;const i=this.doc;i!==null?y(i,r=>{const l=At(r,this,t);n||(n={},l.currentAttributes.forEach((o,h)=>{n[h]=o})),le(r,this,l,e,n)}):this._pending.push(()=>this.insert(t,e,n))}insertEmbed(t,e,n={}){const i=this.doc;i!==null?y(i,r=>{const l=At(r,this,t);le(r,this,l,e,n)}):this._pending.push(()=>this.insertEmbed(t,e,n))}delete(t,e){if(e===0)return;const n=this.doc;n!==null?y(n,i=>{un(i,At(i,this,t),e)}):this._pending.push(()=>this.delete(t,e))}format(t,e,n){if(e===0)return;const i=this.doc;i!==null?y(i,r=>{const l=At(r,this,t);l.right!==null&&dn(r,this,l,e,n)}):this._pending.push(()=>this.format(t,e,n))}removeAttribute(t){this.doc!==null?y(this.doc,e=>{Vt(e,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,e){this.doc!==null?y(this.doc,n=>{Re(n,this,t,e)}):this._pending.push(()=>this.setAttribute(t,e))}getAttribute(t){return Ve(this,t)}getAttributes(t){return Yn(this)}_write(t){t.writeTypeRef(tr)}}class oe{constructor(t,e=()=>!0){this._filter=e,this._root=t,this._currentNode=t._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let t=this._currentNode,e=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(e)))do if(e=t.content.type,!t.deleted&&(e.constructor===D||e.constructor===nt)&&e._start!==null)t=e._start;else for(;t!==null;)if(t.right!==null){t=t.right;break}else t.parent===this._root?t=null:t=t.parent._item;while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class nt extends A{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,e){super._integrate(t,e),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new nt}clone(){const t=new nt;return t.insert(0,this.toArray().map(e=>e instanceof A?e.clone():e)),t}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new oe(this,t)}querySelector(t){t=t.toUpperCase();const n=new oe(this,i=>i.nodeName&&i.nodeName.toUpperCase()===t).next();return n.done?null:n.value}querySelectorAll(t){return t=t.toUpperCase(),Array.from(new oe(this,e=>e.nodeName&&e.nodeName.toUpperCase()===t))}_callObserver(t,e){qt(this,t,new qi(this,e,t))}toString(){return Hn(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,e={},n){const i=t.createDocumentFragment();return n!==void 0&&n._createAssociation(i,this),pt(this,r=>{i.insertBefore(r.toDOM(t,e,n),null)}),i}insert(t,e){this.doc!==null?y(this.doc,n=>{Wn(n,this,t,e)}):this._prelimContent.splice(t,0,...e)}insertAfter(t,e){if(this.doc!==null)y(this.doc,n=>{const i=t&&t instanceof A?t._item:t;Rt(n,this,i,e)});else{const n=this._prelimContent,i=t===null?0:n.findIndex(r=>r===t)+1;if(i===0&&t!==null)throw Gt("Reference item not found");n.splice(i,0,...e)}}delete(t,e=1){this.doc!==null?y(this.doc,n=>{Jn(n,this,t,e)}):this._prelimContent.splice(t,e)}toArray(){return jn(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return $n(this,t)}slice(t=0,e=this.length){return Bn(this,t,e)}forEach(t){pt(this,t)}_write(t){t.writeTypeRef(nr)}}class D extends nt{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,e){super._integrate(t,e),this._prelimAttrs.forEach((n,i)=>{this.setAttribute(i,n)}),this._prelimAttrs=null}_copy(){return new D(this.nodeName)}clone(){const t=new D(this.nodeName),e=this.getAttributes();for(const n in e)t.setAttribute(n,e[n]);return t.insert(0,this.toArray().map(n=>n instanceof A?n.clone():n)),t}toString(){const t=this.getAttributes(),e=[],n=[];for(const o in t)n.push(o);n.sort();const i=n.length;for(let o=0;o<i;o++){const h=n[o];e.push(h+'="'+t[h]+'"')}const r=this.nodeName.toLocaleLowerCase(),l=e.length>0?" "+e.join(" "):"";return`<${r}${l}>${super.toString()}</${r}>`}removeAttribute(t){this.doc!==null?y(this.doc,e=>{Vt(e,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,e){this.doc!==null?y(this.doc,n=>{Re(n,this,t,e)}):this._prelimAttrs.set(t,e)}getAttribute(t){return Ve(this,t)}hasAttribute(t){return Pn(this,t)}getAttributes(t){return Yn(this)}toDOM(t=document,e={},n){const i=t.createElement(this.nodeName),r=this.getAttributes();for(const l in r)i.setAttribute(l,r[l]);return pt(this,l=>{i.appendChild(l.toDOM(t,e,n))}),n!==void 0&&n._createAssociation(i,this),i}_write(t){t.writeTypeRef(er),t.writeKey(this.nodeName)}}class qi extends Yt{constructor(t,e,n){super(t,n),this.childListChanged=!1,this.attributesChanged=new Set,e.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class M extends et{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new M}clone(){const t=new M;return t.applyDelta(this.toDelta()),t}toDOM(t=document,e,n){const i=t.createTextNode(this.toString());return n!==void 0&&n._createAssociation(i,this),i}toString(){return this.toDelta().map(t=>{const e=[];for(const i in t.attributes){const r=[];for(const l in t.attributes[i])r.push({key:l,value:t.attributes[i][l]});r.sort((l,o)=>l.key<o.key?-1:1),e.push({nodeName:i,attrs:r})}e.sort((i,r)=>i.nodeName<r.nodeName?-1:1);let n="";for(let i=0;i<e.length;i++){const r=e[i];n+=`<${r.nodeName}`;for(let l=0;l<r.attrs.length;l++){const o=r.attrs[l];n+=` ${o.key}="${o.value}"`}n+=">"}n+=t.insert;for(let i=e.length-1;i>=0;i--)n+=`</${e[i].nodeName}>`;return n}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(sr)}}class Qn{constructor(t,e){this.id=t,this.length=e}get deleted(){throw O()}mergeWith(t){return!1}write(t,e,n){throw O()}integrate(t,e){throw O()}}const Ki=0;class H extends Qn{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,e){e>0&&(this.id.clock+=e,this.length-=e),Un(t.doc.store,this)}write(t,e){t.writeInfo(Ki),t.writeLen(this.length-e)}getMissing(t,e){return null}}class Kt{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Kt(this.content)}splice(t){throw O()}mergeWith(t){return!1}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeBuf(this.content)}getRef(){return 3}}class Ft{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Ft(this.len)}splice(t){const e=new Ft(this.len-t);return this.len=t,e}mergeWith(t){return this.len+=t.len,!0}integrate(t,e){xe(t.deleteSet,e.id.client,e.id.clock,this.len),e.markDeleted()}delete(t){}gc(t){}write(t,e){t.writeLen(this.len-e)}getRef(){return 1}}const Xi=(s,t)=>new lt({guid:s,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1});class Xt{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const e={};this.opts=e,t.gc||(e.gc=!1),t.autoLoad&&(e.autoLoad=!0),t.meta!==null&&(e.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Xt(Xi(this.doc.guid,this.opts))}splice(t){throw O()}mergeWith(t){return!1}integrate(t,e){this.doc._item=e,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,e){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}class ct{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new ct(this.embed)}splice(t){throw O()}mergeWith(t){return!1}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeJSON(this.embed)}getRef(){return 5}}class S{constructor(t,e){this.key=t,this.value=e}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new S(this.key,this.value)}splice(t){throw O()}mergeWith(t){return!1}integrate(t,e){e.parent._searchMarker=null}delete(t){}gc(t){}write(t,e){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}class st{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new st(this.arr)}splice(t){const e=new st(this.arr.slice(t));return this.arr=this.arr.slice(0,t),e}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,e){}delete(t){}gc(t){}write(t,e){const n=this.arr.length;t.writeLen(n-e);for(let i=e;i<n;i++){const r=this.arr[i];t.writeAny(r)}}getRef(){return 8}}class x{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new x(this.str)}splice(t){const e=new x(this.str.slice(t));this.str=this.str.slice(0,t);const n=this.str.charCodeAt(t-1);return n>=55296&&n<=56319&&(this.str=this.str.slice(0,t-1)+"\uFFFD",e.str="\uFFFD"+e.str.slice(1)),e}mergeWith(t){return this.str+=t.str,!0}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeString(e===0?this.str:this.str.slice(e))}getRef(){return 4}}const Zi=0,Qi=1,tr=2,er=3,nr=4,sr=6;class L{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new L(this.type._copy())}splice(t){throw O()}mergeWith(t){return!1}integrate(t,e){this.type._integrate(t.doc,e)}delete(t){let e=this.type._start;for(;e!==null;)e.deleted?t._mergeStructs.push(e):e.delete(t),e=e.right;this.type._map.forEach(n=>{n.deleted?t._mergeStructs.push(n):n.delete(t)}),t.changed.delete(this.type)}gc(t){let e=this.type._start;for(;e!==null;)e.gc(t,!0),e=e.right;this.type._start=null,this.type._map.forEach(n=>{for(;n!==null;)n.gc(t,!0),n=n.left}),this.type._map=new Map}write(t,e){this.type._write(t)}getRef(){return 7}}const pe=(s,t)=>{let e=t,n=0,i;do n>0&&(e=m(e.client,e.clock+n)),i=Ot(s,e),n=e.clock-i.id.clock,e=i.redone;while(e!==null&&i instanceof b);return{item:i,diff:n}},Fe=(s,t)=>{for(;s!==null&&s.keep!==t;)s.keep=t,s=s.parent._item},ts=(s,t,e)=>{const{client:n,clock:i}=t.id,r=new b(m(n,i+e),t,m(n,i+e-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(e));return t.deleted&&r.markDeleted(),t.keep&&(r.keep=!0),t.redone!==null&&(r.redone=m(t.redone.client,t.redone.clock+e)),t.right=r,r.right!==null&&(r.right.left=r),s._mergeStructs.push(r),r.parentSub!==null&&r.right===null&&r.parent._map.set(r.parentSub,r),t.length=e,r},es=(s,t,e,n,i)=>{const r=s.doc,l=r.store,o=r.clientID,h=t.redone;if(h!==null)return T(s,h);let c=t.parent._item,a=null,d;if(c!==null&&c.deleted===!0){if(c.redone===null&&(!e.has(c)||es(s,c,e,n,i)===null))return null;for(;c.redone!==null;)c=T(s,c.redone)}const f=c===null?t.parent:c.content.type;if(t.parentSub===null){for(a=t.left,d=t;a!==null;){let p=a;for(;p!==null&&p.parent._item!==c;)p=p.redone===null?null:T(s,p.redone);if(p!==null&&p.parent._item===c){a=p;break}a=a.left}for(;d!==null;){let p=d;for(;p!==null&&p.parent._item!==c;)p=p.redone===null?null:T(s,p.redone);if(p!==null&&p.parent._item===c){d=p;break}d=d.right}}else if(d=null,t.right&&!i){for(a=t;a!==null&&a.right!==null&&rt(n,a.right.id);)a=a.right;for(;a!==null&&a.redone!==null;)a=T(s,a.redone);if(a&&a.right!==null)return null}else a=f._map.get(t.parentSub)||null;const u=E(l,o),g=m(o,u),w=new b(g,a,a&&a.lastId,d,d&&d.id,f,t.parentSub,t.content.copy());return t.redone=g,Fe(w,!0),w.integrate(s,0),w};class b extends Qn{constructor(t,e,n,i,r,l,o,h){super(t,h.getLength()),this.origin=n,this.left=e,this.right=i,this.rightOrigin=r,this.parent=l,this.parentSub=o,this.redone=null,this.content=h,this.info=this.content.isCountable()?Ge:0}set marker(t){(this.info&ne)>0!==t&&(this.info^=ne)}get marker(){return(this.info&ne)>0}get keep(){return(this.info&$e)>0}set keep(t){this.keep!==t&&(this.info^=$e)}get countable(){return(this.info&Ge)>0}get deleted(){return(this.info&ee)>0}set deleted(t){this.deleted!==t&&(this.info^=ee)}markDeleted(){this.info|=ee}getMissing(t,e){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=E(e,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=E(e,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Dt&&this.id.client!==this.parent.client&&this.parent.clock>=E(e,this.parent.client))return this.parent.client;if(this.origin&&(this.left=rn(t,e,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=T(t,this.rightOrigin),this.rightOrigin=this.right.id),(this.left&&this.left.constructor===H||this.right&&this.right.constructor===H)&&(this.parent=null),!this.parent)this.left&&this.left.constructor===b&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===b&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===Dt){const n=Ot(e,this.parent);n.constructor===H?this.parent=null:this.parent=n.content.type}return null}integrate(t,e){if(e>0&&(this.id.clock+=e,this.left=rn(t,t.doc.store,m(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(e),this.length-=e),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let n=this.left,i;if(n!==null)i=n.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const r=new Set,l=new Set;for(;i!==null&&i!==this.right;){if(l.add(i),r.add(i),St(this.origin,i.origin)){if(i.id.client<this.id.client)n=i,r.clear();else if(St(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&l.has(Ot(t.doc.store,i.origin)))r.has(Ot(t.doc.store,i.origin))||(n=i,r.clear());else break;i=i.right}this.left=n}if(this.left!==null){const n=this.left.right;this.right=n,this.left.right=this}else{let n;if(this.parentSub!==null)for(n=this.parent._map.get(this.parentSub)||null;n!==null&&n.left!==null;)n=n.left;else n=this.parent._start,this.parent._start=this;this.right=n}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),Un(t.doc.store,this),this.content.integrate(t,this),on(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new H(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:m(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&St(t.origin,this.lastId)&&this.right===t&&St(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const e=this.parent._searchMarker;return e&&e.forEach(n=>{n.p===t&&(n.p=this,!this.deleted&&this.countable&&(n.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const e=this.parent;this.countable&&this.parentSub===null&&(e._length-=this.length),this.markDeleted(),xe(t.deleteSet,this.id.client,this.id.clock,this.length),on(t,e,this.parentSub),this.content.delete(t)}}gc(t,e){if(!this.deleted)throw F();this.content.gc(t),e?xi(t,this,new H(this.id,this.length)):this.content=new Ft(this.length)}write(t,e){const n=e>0?m(this.id.client,this.id.clock+e-1):this.origin,i=this.rightOrigin,r=this.parentSub,l=this.content.getRef()&Ls|(n===null?0:at)|(i===null?0:Sn)|(r===null?0:xs);if(t.writeInfo(l),n!==null&&t.writeLeftID(n),i!==null&&t.writeRightID(i),n===null&&i===null){const o=this.parent;if(o._item!==void 0){const h=o._item;if(h===null){const c=ut(o);t.writeParentInfo(!0),t.writeString(c)}else t.writeParentInfo(!1),t.writeLeftID(h.id)}else o.constructor===String?(t.writeParentInfo(!0),t.writeString(o)):o.constructor===Dt?(t.writeParentInfo(!1),t.writeLeftID(o)):F();r!==null&&t.writeString(r)}this.content.write(t,e)}}const ns=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},ss="__ $YJS$ __";ns[ss]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");ns[ss]=!0;const ir=()=>{let s=!0;return(t,e)=>{if(s){s=!1;try{t()}finally{s=!0}}else e!==void 0&&e()}},rr=(s,t)=>{let e=0,n=0;for(;e<s.length&&e<t.length&&s[e]===t[e];)e++;for(;n+e<s.length&&n+e<t.length&&s[s.length-n-1]===t[t.length-n-1];)n++;return{index:e,remove:s.length-e-n,insert:t.slice(e,t.length-n)}},lr=rr,k=new be("y-sync"),Q=new be("y-undo");new be("yjs-cursor");const Bt=(s,t)=>t===void 0?!s.deleted:t.sv.has(s.id.client)&&t.sv.get(s.id.client)>s.id.clock&&!rt(t.ds,s.id),or=[{light:"#ecd44433",dark:"#ecd444"}],cr=(s,t,e)=>{if(!s.has(e)){if(s.size<t.length){const n=tt();s.forEach(i=>n.add(i)),t=t.filter(i=>!n.has(i))}s.set(e,Ks(t))}return s.get(e)},hr=(s,{colors:t=or,colorMapping:e=new Map,permanentUserData:n=null,onFirstRender:i=()=>{}}={})=>{let r=!1,l;const o=new _n({props:{editable:h=>{const c=k.getState(h);return c.snapshot==null&&c.prevSnapshot==null}},key:k,state:{init:(h,c)=>({type:s,doc:s.doc,binding:null,snapshot:null,prevSnapshot:null,isChangeOrigin:!1,addToHistory:!0,colors:t,colorMapping:e,permanentUserData:n}),apply:(h,c)=>{const a=h.getMeta(k);if(a!==void 0){c=Object.assign({},c);for(const d in a)c[d]=a[d]}return c.addToHistory=h.getMeta("addToHistory")!==!1,c.isChangeOrigin=a!==void 0&&!!a.isChangeOrigin,c.binding!==null&&a!==void 0&&(a.snapshot!=null||a.prevSnapshot!=null)&&ae(0,()=>{c.binding==null||c.binding.isDestroyed||(a.restore==null?c.binding._renderSnapshot(a.snapshot,a.prevSnapshot,c):(c.binding._renderSnapshot(a.snapshot,a.snapshot,c),delete c.restore,delete c.snapshot,delete c.prevSnapshot,c.binding._prosemirrorChanged(c.binding.prosemirrorView.state.doc)))}),c}},view:h=>{const c=new dr(s,h);return l!=null&&l.destroy(),l=ae(0,()=>{c._forceRerender(),h.dispatch(h.state.tr.setMeta(k,{binding:c})),i()}),{update:()=>{const a=o.getState(h.state);if(a.snapshot==null&&a.prevSnapshot==null&&(r||h.state.doc.content.findDiffStart(h.state.doc.type.createAndFill().content)!==null)){if(r=!0,a.addToHistory===!1&&!a.isChangeOrigin){const d=Q.getState(h.state),f=d&&d.undoManager;f&&f.stopCapturing()}a.doc.transact(d=>{d.meta.set("addToHistory",a.addToHistory),c._prosemirrorChanged(h.state.doc)},k)}},destroy:()=>{l.destroy(),c.destroy()}}}});return o},ar=(s,t,e)=>{if(t!==null&&t.anchor!==null&&t.head!==null){const n=wn(e.doc,e.type,t.anchor,e.mapping),i=wn(e.doc,e.type,t.head,e.mapping);n!==null&&i!==null&&(s=s.setSelection(cs.create(s.doc,n,i)))}},we=(s,t)=>({anchor:pn(t.selection.anchor,s.type,s.mapping),head:pn(t.selection.head,s.type,s.mapping)});class dr{constructor(t,e){this.type=t,this.prosemirrorView=e,this.mux=ir(),this.isDestroyed=!1,this.mapping=new Map,this._observeFunction=this._typeChanged.bind(this),this.doc=t.doc,this.beforeTransactionSelection=null,this.beforeAllTransactions=()=>{this.beforeTransactionSelection===null&&(this.beforeTransactionSelection=we(this,e.state))},this.afterAllTransactions=()=>{this.beforeTransactionSelection=null},this.doc.on("beforeAllTransactions",this.beforeAllTransactions),this.doc.on("afterAllTransactions",this.afterAllTransactions),t.observeDeep(this._observeFunction),this._domSelectionInView=null}get _tr(){return this.prosemirrorView.state.tr.setMeta("addToHistory",!1)}_isLocalCursorInView(){return this.prosemirrorView.hasFocus()?(Is&&this._domSelectionInView===null&&(ae(0,()=>{this._domSelectionInView=null}),this._domSelectionInView=this._isDomSelectionInView()),this._domSelectionInView):!1}_isDomSelectionInView(){const t=this.prosemirrorView._root.getSelection(),e=this.prosemirrorView._root.createRange();e.setStart(t.anchorNode,t.anchorOffset),e.setEnd(t.focusNode,t.focusOffset),e.getClientRects().length===0&&e.startContainer&&e.collapsed&&e.selectNodeContents(e.startContainer);const i=e.getBoundingClientRect(),r=W.documentElement;return i.bottom>=0&&i.right>=0&&i.left<=(window.innerWidth||r.clientWidth||0)&&i.top<=(window.innerHeight||r.clientHeight||0)}renderSnapshot(t,e){e||(e=Ue(Wt(),new Map)),this.prosemirrorView.dispatch(this._tr.setMeta(k,{snapshot:t,prevSnapshot:e}))}unrenderSnapshot(){this.mapping=new Map,this.mux(()=>{const t=this.type.toArray().map(n=>xt(n,this.prosemirrorView.state.schema,this.mapping)).filter(n=>n!==null),e=this._tr.replace(0,this.prosemirrorView.state.doc.content.size,new bt(new kt(t),0,0));e.setMeta(k,{snapshot:null,prevSnapshot:null}),this.prosemirrorView.dispatch(e)})}_forceRerender(){this.mapping=new Map,this.mux(()=>{const t=this.type.toArray().map(n=>xt(n,this.prosemirrorView.state.schema,this.mapping)).filter(n=>n!==null),e=this._tr.replace(0,this.prosemirrorView.state.doc.content.size,new bt(new kt(t),0,0));this.prosemirrorView.dispatch(e.setMeta(k,{isChangeOrigin:!0}))})}_renderSnapshot(t,e,n){t||(t=Mi(this.doc)),this.mapping=new Map,this.mux(()=>{this.doc.transact(i=>{const r=n.permanentUserData;r&&r.dss.forEach(c=>{B(i,c,a=>{})});const l=(c,a)=>{const d=c==="added"?r.getUserByClientId(a.client):r.getUserByDeletedId(a);return{user:d,type:c,color:cr(n.colorMapping,n.colors,d)}},o=zn(this.type,new Le(e.ds,t.sv)).map(c=>!c._item.deleted||Bt(c._item,t)||Bt(c._item,e)?xt(c,this.prosemirrorView.state.schema,new Map,t,e,l):null).filter(c=>c!==null),h=this._tr.replace(0,this.prosemirrorView.state.doc.content.size,new bt(new kt(o),0,0));this.prosemirrorView.dispatch(h.setMeta(k,{isChangeOrigin:!0}))},k)})}_typeChanged(t,e){const n=k.getState(this.prosemirrorView.state);if(t.length===0||n.snapshot!=null||n.prevSnapshot!=null){this.renderSnapshot(n.snapshot,n.prevSnapshot);return}this.mux(()=>{const i=(o,h)=>this.mapping.delete(h);B(e,e.deleteSet,o=>o.constructor===b&&this.mapping.delete(o.content.type)),e.changed.forEach(i),e.changedParentTypes.forEach(i);const r=this.type.toArray().map(o=>is(o,this.prosemirrorView.state.schema,this.mapping)).filter(o=>o!==null);let l=this._tr.replace(0,this.prosemirrorView.state.doc.content.size,new bt(new kt(r),0,0));ar(l,this.beforeTransactionSelection,this),l=l.setMeta(k,{isChangeOrigin:!0}),this.beforeTransactionSelection!==null&&this._isLocalCursorInView()&&l.scrollIntoView(),this.prosemirrorView.dispatch(l)})}_prosemirrorChanged(t){this.mux(()=>{this.doc.transact(e=>{_e(this.doc,this.type,t,this.mapping),this.beforeTransactionSelection=we(this,this.prosemirrorView.state)},k)})}destroy(){this.isDestroyed=!0,this.type.unobserveDeep(this._observeFunction),this.doc.off("beforeAllTransactions",this.beforeAllTransactions),this.doc.off("afterAllTransactions",this.afterAllTransactions)}}const is=(s,t,e,n,i,r)=>{const l=e.get(s);if(l===void 0){if(s instanceof D)return xt(s,t,e,n,i,r);throw O()}return l},xt=(s,t,e,n,i,r)=>{const l=[],o=h=>{if(h.constructor===D){const c=is(h,t,e,n,i,r);c!==null&&l.push(c)}else{const c=ur(h,t,e,n,i,r);c!==null&&c.forEach(a=>{a!==null&&l.push(a)})}};n===void 0||i===void 0?s.toArray().forEach(o):zn(s,new Le(i.ds,n.sv)).forEach(o);try{const h=s.getAttributes(n);n!==void 0&&(Bt(s._item,n)?Bt(s._item,i)||(h.ychange=r?r("added",s._item.id):{type:"added"}):h.ychange=r?r("removed",s._item.id):{type:"removed"});const c=t.node(s.nodeName,h,l);return e.set(s,c),c}catch{return s.doc.transact(c=>{s._item.delete(c)},k),e.delete(s),null}},ur=(s,t,e,n,i,r)=>{const l=[],o=s.toDelta(n,i,r);try{for(let h=0;h<o.length;h++){const c=o[h],a=[];for(const d in c.attributes)a.push(t.mark(d,c.attributes[d]));l.push(t.text(c.insert,a))}}catch{return s.doc.transact(c=>{s._item.delete(c)},k),null}return l},fr=(s,t)=>{const e=new M,n=s.map(i=>({insert:i.text,attributes:ls(i.marks)}));return e.applyDelta(n),t.set(e,s),e},gr=(s,t)=>{const e=new D(s.type.name);for(const n in s.attrs){const i=s.attrs[n];i!==null&&n!=="ychange"&&e.setAttribute(n,i)}return e.insert(0,Zt(s).map(n=>me(n,t))),t.set(e,s),e},me=(s,t)=>s instanceof Array?fr(s,t):gr(s,t),fn=s=>typeof s=="object"&&s!==null,Be=(s,t)=>{const e=Object.keys(s).filter(i=>s[i]!==null);let n=e.length===Object.keys(t).filter(i=>t[i]!==null).length;for(let i=0;i<e.length&&n;i++){const r=e[i],l=s[r],o=t[r];n=r==="ychange"||l===o||fn(l)&&fn(o)&&Be(l,o)}return n},Zt=s=>{const t=s.content.content,e=[];for(let n=0;n<t.length;n++){const i=t[n];if(i.isText){const r=[];for(let l=t[n];n<t.length&&l.isText;l=t[++n])r.push(l);n--,e.push(r)}else e.push(i)}return e},rs=(s,t)=>{const e=s.toDelta();return e.length===t.length&&e.every((n,i)=>n.insert===t[i].text&&An(n.attributes||{}).length===t[i].marks.length&&t[i].marks.every(r=>Be(n.attributes[r.type.name]||{},r.attrs)))},mt=(s,t)=>{if(s instanceof D&&!(t instanceof Array)&&ye(s,t)){const e=Zt(t);return s._length===e.length&&Be(s.getAttributes(),t.attrs)&&s.toArray().every((n,i)=>mt(n,e[i]))}return s instanceof M&&t instanceof Array&&rs(s,t)},jt=(s,t)=>s===t||s instanceof Array&&t instanceof Array&&s.length===t.length&&s.every((e,n)=>t[n]===e),gn=(s,t,e)=>{const n=s.toArray(),i=Zt(t),r=i.length,l=n.length,o=zt(l,r);let h=0,c=0,a=!1;for(;h<o;h++){const d=n[h],f=i[h];if(jt(e.get(d),f))a=!0;else if(!mt(d,f))break}for(;h+c<o;c++){const d=n[l-c-1],f=i[r-c-1];if(jt(e.get(d),f))a=!0;else if(!mt(d,f))break}return{equalityFactor:h+c,foundMappedChild:a}},pr=s=>{let t="",e=s._start;const n={};for(;e!==null;)e.deleted||(e.countable&&e.content instanceof x?t+=e.content.str:e.content instanceof S&&(n[e.content.key]=null)),e=e.right;return{str:t,nAttrs:n}},wr=(s,t,e)=>{e.set(s,t);const{nAttrs:n,str:i}=pr(s),r=t.map(c=>({insert:c.text,attributes:Object.assign({},n,ls(c.marks))})),{insert:l,remove:o,index:h}=lr(i,r.map(c=>c.insert).join(""));s.delete(h,o),s.insert(h,l),s.applyDelta(r.map(c=>({retain:c.insert.length,attributes:c.attributes})))},ls=s=>{const t={};return s.forEach(e=>{e.type.name!=="ychange"&&(t[e.type.name]=e.attrs)}),t},_e=(s,t,e,n)=>{if(t instanceof D&&t.nodeName!==e.type.name)throw new Error("node name mismatch!");if(n.set(t,e),t instanceof D){const d=t.getAttributes(),f=e.attrs;for(const u in f)f[u]!==null?d[u]!==f[u]&&u!=="ychange"&&t.setAttribute(u,f[u]):t.removeAttribute(u);for(const u in d)f[u]===void 0&&t.removeAttribute(u)}const i=Zt(e),r=i.length,l=t.toArray(),o=l.length,h=zt(r,o);let c=0,a=0;for(;c<h;c++){const d=l[c],f=i[c];if(!jt(n.get(d),f))if(mt(d,f))n.set(d,f);else break}for(;a+c+1<h;a++){const d=l[o-a-1],f=i[r-a-1];if(!jt(n.get(d),f))if(mt(d,f))n.set(d,f);else break}s.transact(()=>{for(;o-c-a>0&&r-c-a>0;){const f=l[c],u=i[c],g=l[o-a-1],w=i[r-a-1];if(f instanceof M&&u instanceof Array)rs(f,u)||wr(f,u,n),c+=1;else{let p=f instanceof D&&ye(f,u),U=g instanceof D&&ye(g,w);if(p&&U){const P=gn(f,u,n),q=gn(g,w,n);P.foundMappedChild&&!q.foundMappedChild?U=!1:!P.foundMappedChild&&q.foundMappedChild||P.equalityFactor<q.equalityFactor?p=!1:U=!1}p?(_e(s,f,u,n),c+=1):U?(_e(s,g,w,n),a+=1):(t.delete(c,1),t.insert(c,[me(u,n)]),c+=1)}}const d=o-c-a;if(o===1&&r===0&&l[0]instanceof M?l[0].delete(0,l[0].length):d>0&&t.delete(c,d),c+a<r){const f=[];for(let u=c;u<r-a;u++)f.push(me(i[u],n));t.insert(c,f)}},k)},ye=(s,t)=>!(t instanceof Array)&&s.nodeName===t.type.name,pn=(s,t,e)=>{if(s===0)return re(t,0);let n=t._first===null?null:t._first.content.type;for(;n!==null&&t!==n;){if(n instanceof M){if(n._length>=s)return re(n,s);if(s-=n._length,n._item!==null&&n._item.next!==null)n=n._item.next.content.type;else{do n=n._item===null?null:n._item.parent,s--;while(n!==t&&n!==null&&n._item!==null&&n._item.next===null);n!==null&&n!==t&&(n=n._item===null?null:n._item.next.content.type)}}else{const i=(e.get(n)||{nodeSize:0}).nodeSize;if(n._first!==null&&s<i)n=n._first.content.type,s--;else{if(s===1&&n._length===0&&i>1)return new Nt(n._item===null?null:n._item.id,n._item===null?ut(n):null,null);if(s-=i,n._item!==null&&n._item.next!==null)n=n._item.next.content.type;else{if(s===0)return n=n._item===null?n:n._item.parent,new Nt(n._item===null?null:n._item.id,n._item===null?ut(n):null,null);do n=n._item.parent,s--;while(n!==t&&n._item.next===null);n!==t&&(n=n._item.next.content.type)}}}if(n===null)throw F();if(s===0&&n.constructor!==M&&n!==t)return mr(n._item.parent,n._item)}return re(t,t._length)},mr=(s,t)=>{let e=null,n=null;return s._item===null?n=ut(s):e=m(s._item.id.client,s._item.id.clock),new Nt(e,n,t.id)},wn=(s,t,e,n)=>{const i=Di(e,s);if(i===null||i.type!==t&&!ft(t,i.type._item))return null;let r=i.type,l=0;if(r.constructor===M)l=i.index;else if(r._item===null||!r._item.deleted){let o=r._first,h=0;for(;h<r._length&&h<i.index&&o!==null;){if(!o.deleted){const c=o.content.type;h++,c instanceof M?l+=c._length:l+=n.get(c).nodeSize}o=o.right}l+=1}for(;r!==t&&r._item!==null;){const o=r._item.parent;if(o._item===null||!o._item.deleted){l+=1;let h=o._first;for(;h!==null;){const c=h.content.type;if(c===r)break;h.deleted||(c instanceof M?l+=c._length:l+=n.get(c).nodeSize),h=h.right}}r=o}return l-1},_r=s=>{const t=Q.getState(s).undoManager;if(t!=null)return t.undo(),!0},mn=s=>{const t=Q.getState(s).undoManager;if(t!=null)return t.redo(),!0},yr=new Set(["paragraph"]),br=(s,t)=>!(s instanceof b)||!(s.content instanceof L)||!(s.content.type instanceof et||s.content.type instanceof D&&t.has(s.content.type.nodeName))||s.content.type._length===0,kr=({protectedNodes:s=yr,trackedOrigins:t=[],undoManager:e=null}={})=>new _n({key:Q,state:{init:(n,i)=>{const r=k.getState(i),l=e||new Vi(r.type,{trackedOrigins:new Set([k].concat(t)),deleteFilter:o=>br(o,s),captureTransaction:o=>o.meta.get("addToHistory")!==!1});return{undoManager:l,prevSel:null,hasUndoOps:l.undoStack.length>0,hasRedoOps:l.redoStack.length>0}},apply:(n,i,r,l)=>{const o=k.getState(l).binding,h=i.undoManager,c=h.undoStack.length>0,a=h.redoStack.length>0;return o?{undoManager:h,prevSel:we(o,r),hasUndoOps:c,hasRedoOps:a}:c!==i.hasUndoOps||a!==i.hasRedoOps?Object.assign({},i,{hasUndoOps:h.undoStack.length>0,hasRedoOps:h.redoStack.length>0}):i}},view:n=>{const i=k.getState(n.state),r=Q.getState(n.state).undoManager;return r.on("stack-item-added",({stackItem:l})=>{const o=i.binding;o&&l.meta.set(o,Q.getState(n.state).prevSel)}),r.on("stack-item-popped",({stackItem:l})=>{const o=i.binding;o&&(o.beforeTransactionSelection=l.meta.get(o)||o.beforeTransactionSelection)}),{destroy:()=>{r.destroy()}}}}),os=new lt,Sr=new Ai(os),Cr=os.getXmlFragment("pm-doc");hs(as({schema:us,history:!1}).concat([hr(Cr,{permanentUserData:Sr,colors:[{light:"#ecd44433",dark:"#ecd444"},{light:"#ee635233",dark:"#ee6352"},{light:"#6eeb8333",dark:"#6eeb83"}]}),kr(),ds({"Mod-z":_r,"Mod-y":mn,"Mod-Shift-z":mn})]));
